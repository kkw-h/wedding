## 项目结构规划

- 根目录新增 `web` 前端工程，模块化按页面功能划分目录。
- 目录结构（与页面设计一一映射）：
```
web/
  package.json
  vite.config.ts
  tsconfig.json
  .eslintrc.cjs
  .prettierrc
  .editorconfig
  public/
  src/
    main.tsx
    app/
      App.tsx
      layout/
        TopNav.tsx
        SideMenu.tsx
      providers/
        ThemeProvider.tsx
        StoreProvider.tsx
      router/
        routes.tsx
    shared/
      components/
        HistoryPanel/
          HistoryPanel.tsx
        MarkdownView/
          MarkdownView.tsx
      hooks/
        usePagination.ts
      utils/
        phone.ts
        format.ts
      api/
        client.ts
        types.ts
    modules/
      preplans/
        pages/
          List.tsx            // 路由 `/preplans`
          Detail.tsx          // 路由 `/preplans/:id`
          Edit.tsx            // 路由 `/preplans/new` `/preplans/:id/edit`
        components/
          PreplanForm.tsx
        services/
          api.ts
        types.ts
        store.ts
      flows/
        pages/
          List.tsx            // 路由 `/flows`
          Edit.tsx            // 路由 `/flows/new` `/flows/:id/edit`
        components/
          FlowForm.tsx
        services/
          api.ts
        types.ts
        store.ts
      venues/
        pages/
          List.tsx            // 路由 `/venues`
          Detail.tsx          // 路由 `/venues/:id`
          Edit.tsx            // 路由 `/venues/new` `/venues/:id/edit`
        components/
          VenueForm.tsx
        services/
          api.ts
        types.ts
        store.ts
      staff/
        pages/
          List.tsx            // 路由 `/staff`
          Detail.tsx          // 路由 `/staff/:id`
          Edit.tsx            // 路由 `/staff/:id/edit`
        components/
          StaffForm.tsx
        services/
          api.ts
        types.ts
        store.ts
      budgets/
        pages/
          List.tsx            // 路由 `/budgets`
        services/
          api.ts
        types.ts
    styles/
      globals.scss
```

## 技术选型

- 前端框架：React 18 + TypeScript，生态成熟、路由与表单支持完善。
- 构建工具：Vite（启动/构建速度快，内置 TS/ESM 支持）。
- UI 组件库：Ant Design v5（中文生态完善，表格/表单/布局丰富）。
- 状态管理：Redux Toolkit + RTK Query（标准化全局状态与请求缓存；局部 UI 状态用组件内 state）。
- 路由：React Router v6（声明式路由与嵌套路由）。
- 样式：CSS Modules + Sass（`.module.scss`），Ant Design 主题用 `ConfigProvider` tokens。
- Markdown 渲染：`react-markdown` + `remark-gfm`（遵循 CommonMark；禁用 HTML）。
- HTTP 客户端：Axios（拦截器统一处理鉴权/错误）。
- 代码质量：ESLint（React/TS 规则）+ Prettier（统一格式）。

> 可选替代：若偏好更轻量的状态管理，可将 RTK Query 替换为 SWR；或全局状态改为 Zustand。当前选择更贴合增删改查场景与缓存需求。

## 开发规范

- TypeScript：`strict` 模式，所有 API 返回、组件 props、store 均需类型定义。
- 组件分层：页面 `pages` 负责数据装配与路由；表单/展示组件在 `components`，无副作用；业务服务在 `services`。
- 命名约定：文件 PascalCase 组件，camelCase 方法/变量，模块内统一导出入口。
- 权限与按钮显示：依据角色在页面级进行按钮隐藏（预算模块只读，禁用新建/编辑/删除）。
- 样式规范：局部样式用 CSS Modules；全局变量与重置在 `styles/globals.scss`；避免内联样式。
- Markdown 安全：`react-markdown` 默认禁用 HTML 标签，仅启用标题/列表/加粗；不渲染原生 HTML。
- 电话显示统一：存储原始字符串；展示采用 `138****5678` 打码，点击触发 `tel:`。
- 表单与表格：统一用 AntD Form/Table；分页、筛选采用 `shared/hooks/usePagination`。

## 路由管理方案

- 基础路由表：
  - `/preplans` 列表；`/preplans/:id` 详情；`/preplans/new` 与 `/preplans/:id/edit` 编辑
  - `/flows` 列表；`/flows/new` 与 `/flows/:id/edit` 编辑
  - `/venues` 列表；`/venues/:id` 详情；`/venues/new` 与 `/venues/:id/edit` 编辑
  - `/staff` 列表；`/staff/:id` 详情；`/staff/:id/edit` 编辑
  - `/budgets` 列表（只读）
- 布局：顶栏 `TopNav` + 侧边 `SideMenu`；路由采用嵌套布局（App Layout 包裹各模块）。

## API 请求层实现方式

- 环境变量：`VITE_API_BASE_URL`（在 Vite `import.meta.env` 读取）。
- Axios 客户端：
  - 基础配置：`baseURL`、`timeout`、`headers`
  - 请求拦截：附加鉴权 token（如有）
  - 响应拦截：错误弹窗/日志；统一数据封装
- RTK Query：
  - 为各模块定义 `api.ts`：
    - `preplans`: `list`, `getById`, `create`, `update`, `remove`
    - `flows`: `list`, `getById`, `create`, `update`, `remove`
    - `venues`: `list`, `getById`, `create`, `update`, `remove`
    - `staff`: `list`, `getById`, `update`
    - `budgets`: `list`（只读）
- 类型映射（与文档一致，示例）：
```
// Preplan
interface Preplan { id: string; name: string; type: string; content_md: string; attachments: string[]; history: HistoryItem[]; createdBy: string; updatedAt: string }
// WeddingFlow
interface WeddingFlow { id: string; step_name: string; time: string /* HH:mm */; owner_id: string; owner_name: string; phone: string; note_md?: string; history: HistoryItem[] }
// Venue
interface Venue { id: string; name: string; type?: string; location?: string; price?: number; desc_md?: string; attachments?: string[]; history: HistoryItem[] }
// Staff
interface Staff { id: string; name: string; role: string; phone?: string; wechat?: string; history: HistoryItem[] }
// BudgetItem
interface BudgetItem { id: string; name: string; category: '场地'|'餐饮'|'婚纱照'|'花艺'|'摄影'|'化妆'|'交通'|'其他'; amount: number; note_md?: string; attachments?: string[] }
// HistoryItem
interface HistoryItem { user: string; action: 'create'|'update'|'delete'; timestamp: string; details?: string }
```

## 模块技术实现要点

- 预案（Preplan）：
  - 列表：搜索/筛选、操作列；`content_md` 不在列表渲染
  - 详情：标题、类型标签、Markdown 渲染、附件链接、历史面板
  - 编辑：名称/类型/Markdown 编辑器、附件上传（生成 URL），保存记录历史
- 婚礼流程（WeddingFlow）：
  - 列表：按 `time` 升序，负责人姓名可跳转人员详情，电话点击拨号
  - 编辑：负责人选择器（从 `Staff` 下拉搜索），电话自动填充只读，备注 Markdown
  - 保存后列表自动重排；记录历史
- 场地（Venue）：
  - 列表：名称/类型/位置/价格，操作查看/编辑
  - 详情：完整 Markdown、附件缩略图、历史面板
  - 编辑：数字输入价格、附件多文件上传
- 人员（Staff）：
  - 列表：姓名/角色/电话拨号/微信复制；仅本人或管理员可编辑
  - 详情：电话 `tel:` 链接，微信纯文本
  - 编辑：维护基础信息，系统用户关联暂不在此实现
- 预算（Budget）：
  - 列表：分类筛选、名称关键词搜索、金额显示、附件查看；只读无新建/编辑/删除

## 初始化与配置步骤（待执行）

- 初始化工程：
  - `npm create vite@latest web -- --template react-ts`
  - `cd web`
  - 安装依赖：
    - 运行时：`npm i antd axios @reduxjs/toolkit react-redux react-router-dom react-markdown remark-gfm`
    - 开发时：`npm i -D typescript eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-plugin-react eslint-plugin-react-hooks prettier eslint-config-prettier sass`
- 基本配置：
  - `vite.config.ts`：别名 `@` 指向 `src`，CSS 预处理器启用 Sass
  - `tsconfig.json`：`baseUrl`+`paths`，`strict: true`
  - ESLint：React/TS 推荐规则，Prettier 整合；忽略 `dist`
  - AntD：`ConfigProvider` 主题与中文 locale 设置
  - 全局样式：`styles/globals.scss`（重置、变量）

## 任务分配计划

- 基础设施与框架搭建（负责人 A）
  - Vite/TS/ESLint/Prettier/AntD/Router/Redux/RTK Query 初始化
  - `TopNav`/`SideMenu` 布局与路由装配
- 通用组件与工具（负责人 B）
  - `HistoryPanel`、`MarkdownView`、`usePagination`、`utils/phone`
  - Axios 客户端与拦截器、错误处理
- 预案模块（负责人 C）
  - 列表/详情/编辑页、`PreplanForm`、`services/api.ts`、`types.ts`
- 流程模块（负责人 D）
  - 列表/编辑页、负责人选择器联动 Staff、时间排序逻辑
- 场地模块（负责人 E）
  - 列表/详情/编辑页、附件缩略图
- 人员模块（负责人 F）
  - 列表/详情/编辑页、权限控制（仅本人可编辑）
- 预算模块（负责人 G）
  - 列表页（筛选/搜索/只读约束），无编辑功能

## 开发进度与验收标准

- 里程碑 M1（第 1-2 天）：
  - 完成工程初始化、路由布局、ESLint/Prettier 配置、Axios/RTK Query 基座
  - 验收：项目启动成功；路由可导航；代码检查无错误
- 里程碑 M2（第 3-5 天）：
  - 通用组件与工具完成；预案与流程模块的列表/编辑打通
  - 验收：列表分页/搜索可用；表单校验与保存成功；Markdown 渲染安全
- 里程碑 M3（第 6-7 天）：
  - 场地与人员模块完成；权限控制生效
  - 验收：电话拨号、微信复制可用；仅本人/管理员可编辑
- 里程碑 M4（第 8-9 天）：
  - 预算模块只读完成；全局联调与历史记录
  - 验收：预算分类/关键词筛选；各模块历史面板正确记录
- 里程碑 M5（第 10 天）：
  - 文档与交付清单完善、端到端回归
  - 验收：技术选型/开发规范/任务分配文档齐全；无高优缺陷

## 交付物清单（确认后创建）

- 完整项目初始化配置（`web` 目录工程与基础代码）。
- 技术选型文档：`docs/技术选型.md`（框架/库选择与对比、版本、替代方案）。
- 开发规范文档：`docs/开发规范.md`（TypeScript/组件/样式/路由/API/权限/Markdown 安全）。
- 任务分配计划表：`docs/任务分配.md`（责任人、任务列表、里程碑与验收标准）。

---

如确认以上方案，我将按“初始化与配置步骤”开始创建 `web` 前端工程并落地各模块，随后生成并提交三份文档与基础代码。