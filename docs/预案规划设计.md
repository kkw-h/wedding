这是一个非常敏锐的需求洞察。在婚礼策划中，方案往往需要经历“初稿 -> 内部评审 -> 客户沟通 -> 修改 -> 再沟通 -> 定稿”的漫长过程。

**“谁改的？”“改了哪里？”“以前那个版本好像更好，能不能找回来？”** 是策划师和客户沟通中最高频的痛点。如果只做一个简单的“保存”，一旦误操作或客户反悔，就是灾难。

因此，我们将**“预案编辑历史”**升级为**“全维度的版本控制系统”**。这不仅仅是一个日志，更是策划师的“后悔药”和“定责工具”。

以下是针对**预案规划模块**的深度交互设计方案：

---

# 🎨 预案规划 - 深度版本控制交互设计 (Version Control Design)

## 1. 核心设计逻辑：快照与增量 (Snapshots & Deltas)

为了平衡性能和用户体验，我们不记录每一次键盘敲击，而是采用**“自动保存 + 关键节点快照”**的混合模式。

*   **自动保存 (Auto-Save):** 系统每隔 2-5 分钟或检测到停止操作时自动保存，作为“草稿节点”。
*   **关键版本 (Milestones):** 用户手动点击“保存版本”、“发送给客户”或“导出方案”时，系统强制生成一个带标签的“正式版本”。

---

## 2. 交互界面设计 (UI/UX)

### A. 入口与状态感知
*   **位置：** 编辑器顶部导航栏右侧。
*   **状态显示：** 实时显示状态（如：“所有更改已保存”、“上次修改：2分钟前”）。
*   **交互：** 点击该状态区域，从右侧滑出**“版本历史侧边栏 (Version History Drawer)”**，不遮挡当前画布，方便对照。

### B. 版本历史侧边栏 (The Drawer)
侧边栏是版本管理的主战场，信息层级如下：

1.  **时间轴视图：** 按时间倒序排列版本卡片。
2.  **版本卡片信息：**
    *   **版本号/标签：** 如 `v2.0 (已发客户)`、`v1.5 (内部评审)`、`自动保存`。
    *   **操作人头像：** 明确是主策划、助理还是财务修改的（多人协作时极重要）。
    *   **修改摘要 (Diff Summary)：** 系统自动生成的改动概览。
        *   *例：* 🟢 新增“甜品台预算” | 🔴 删除“迎宾区背景墙” | 🟡 修改“主舞台尺寸”。
3.  **操作按钮：** 每个卡片上提供 [预览]、[恢复此版本]、[复制为新方案]。

### C. 差异对比模式 (Diff View) - **交互亮点**
当用户点击侧边栏中的某个历史版本进行“预览”时，不要只展示那个版本的静态图，而是进入**“对比模式”**。

*   **分屏/高亮逻辑：**
    *   **文本差异：** 类似 Word 修订模式。删除的文字显示~~删除线~~（红色），新增文字显示下划线（绿色）。
    *   **预算差异：** 如果单价变动，显示变化量。
        *   *UI 示例：* `¥5,000` ➔ `¥4,500` (⬇️ ¥500)
    *   **图片/布局差异：**
        *   **方案一（重叠法）：** 在原图位置显示“图片已替换”标记。
        *   **方案二（左右对比）：** 屏幕左侧显示“当前版本”，右侧显示“历史版本”，中间用滑杆（Slider）拖动查看差异。

---

## 3. 关键交互流程 (User Flow)

### 场景一：客户反悔，要求回退到上周的方案
1.  策划师打开当前方案。
2.  点击顶部“上次修改时间”，唤起侧边栏。
3.  滚动时间轴，找到标签为“v1.0 初次提案”的卡片。
4.  点击**“预览”**，系统高亮显示当前版本与 v1.0 的区别（如：鲜花预算从 2w 变成了 3w）。
5.  策划师确认无误，点击**“恢复此版本”**。
6.  **系统提示：** “恢复将覆盖当前草稿，建议先将当前草稿另存为副本。是否继续？”
7.  确认后，编辑器内容瞬间变回 v1.0 状态。

### 场景二：多方案并行（Plan A / Plan B）
婚礼常有这种情况：客户在“森系”和“复古”之间犹豫，策划师需要保留两套方案。

1.  策划师在做完“森系”方案后，点击**“保存为版本”**，命名为“方案A-森系”。
2.  在历史记录中找到该版本，点击**“复制为新方案” (Fork)**。
3.  系统生成一个新的独立项目文件，策划师在此基础上修改为“复古风”。
4.  **价值：** 两个方案独立演进，互不干扰，但数据源头可追溯。

---

## 4. 数据结构字段建议 (Backend Data Structure)

为了支撑上述交互，后端 `Proposal_History` 表需要包含以下关键字段：

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `version_id` | UUID | 唯一标识 |
| `proposal_id` | UUID | 关联的方案ID |
| `parent_version_id` | UUID | 父版本ID（用于构建版本树） |
| `snapshot_data` | JSON | 方案全量数据快照（或增量数据） |
| `change_log` | JSON | 自动生成的修改摘要（用于前端列表展示） |
| `editor_id` | UserID | 修改人 |
| `action_type` | Enum | `AUTO_SAVE` (自动), `MANUAL_SAVE` (手动), `PUBLISH` (发布) |
| `tag_name` | String | 用户自定义标签（如“定稿版”） |
| `created_at` | Timestamp | 修改时间 |

---

## 💡 资深产品经理的额外建议 (Pro Tips)

1.  **变更原因必填（可选设置）：**
    对于已经签约的“执行阶段”方案，如果修改了预算或关键流程，系统应强制弹窗要求填写**“修改原因”**（例如：客户临时要求增加两桌）。这在后期结算扯皮时，是重要的证据链。

2.  **高风险操作预警：**
    如果恢复的版本会导致**预算大幅超支**或**删除已付款的供应商**，系统必须弹出红色高危预警，防止误操作造成经济损失。

3.  **移动端适配：**
    手机端屏幕小，不适合做复杂的“左右对比”。移动端的交互应简化为：**只看日志列表 + 预览静态快照**，不支持复杂的恢复操作，引导用户回 PC 端处理。
