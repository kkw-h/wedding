好的，这是系统落地的“最后一公里”，也是决定这套 SaaS 能否卖给不同规模婚庆公司（从 3 人小作坊到 50 人大公司）的关键。

**权限设计 (RBAC - Role-Based Access Control)** 必须足够灵活，既要保护老板的商业机密（成本、客户资源），又要保证执行层的工作效率。

---

# 🔐 后台管理系统 (Admin) - 权限与页面逻辑设计 (v1.0)

## 1. 核心设计理念：角色与数据隔离

我们将用户分为四个核心层级，每个层级看到的页面和数据截然不同：

1.  **超级管理员 (Admin/老板):** 上帝视角，看钱、看人、看数据。
2.  **主策划/店长 (Manager):** 团队管理，审批流，分配线索。
3.  **执行策划/统筹 (Planner):** 只能看自己负责的项目，操作具体业务。
4.  **外部协作 (Vendor/Freelancer):** 极简权限，仅查看被分配的任务和排期（通常不进入 Admin，只用小程序，但后台需预留接口）。

---

## 2. 角色权限矩阵 (Permission Matrix)

| 功能模块 | 👑 老板 (Admin) | 👔 店长 (Manager) | 👩‍💻 策划师 (Planner) | 🛠️ 财务 (Finance) |
| :--- | :--- | :--- | :--- | :--- |
| **仪表盘** | 全公司营收、毛利、转化率 | 团队业绩、待办审批 | 个人业绩、今日任务 | 待收/待付款项 |
| **线索/CRM** | 所有线索，分配权 | 团队线索，分配权 | **仅自己负责的客户** | 无 |
| **项目方案** | 查看/编辑所有 | 查看/审核团队方案 | 编辑自己方案 | 仅查看合同金额 |
| **预算/报价** | **可见成本/毛利/报价** | **可见成本/毛利/报价** | **仅见报价** (成本脱敏) | 可见成本/实付 |
| **人员调度** | 管理所有资源库 | 调度/审核 | 申请调度 | 结算工资 |
| **设置** | 全局配置、账号管理 | 无 | 无 | 无 |

---

## 3. 页面逻辑与导航结构 (Sitemap & Logic)

后台采用经典的 **左侧导航 + 顶部面包屑 + 右侧内容区** 布局。

### 1. 仪表盘 (Dashboard) - 首页
*   **逻辑：** 根据登录角色动态渲染。
*   **老板视图：**
    *   KPI 卡片：本月签约额、本月回款、毛利率。
    *   漏斗图：线索 -> 进店 -> 方案 -> 签约 -> 执行。
    *   预警：低利润项目预警、客户投诉预警。
*   **策划师视图：**
    *   我的任务：今日待办（To-Do）。
    *   我的日历：近期婚礼档期。
    *   跟进提醒：3个客户超过 7 天未联系。

### 2. 线索与客户 (CRM)
*   **页面：** `线索公海池` | `我的客户`
*   **核心逻辑：**
    *   **撞单检测：** 输入手机号时，系统自动检测该客户是否已被其他策划师录入（防止内部抢单）。
    *   **公海回收：** 如果策划师 15 天未更新跟进记录，线索自动掉回“公海池”，其他人可抢。

### 3. 项目管理 (Project Center) - **核心作业区**
*   **列表页：** 展示项目状态（筹备中、待执行、已完成）。
*   **详情页 (Tab 结构)：**
    *   `概览` (倒计时、核心人员)
    *   `方案` (图文编辑器、布局图)
    *   `预算` (报价单、收款记录)
    *   `任务` (甘特图、SOP)
    *   `人员` (调度表)
    *   `文件` (合同、图纸归档)

### 4. 资源与档期 (Resource)
*   **页面：** `人员库` | `场地库` | `物料库`
*   **逻辑：**
    *   **人员库：** 只有 Manager 以上级别可以添加/删除人员，策划师只能“查看”和“发起邀约”。
    *   **评价系统：** 婚礼结束后，策划师需对 Vendor 进行评分（1-5星），低分人员在下次派单时自动降权。

### 5. 财务中心 (Finance)
*   **页面：** `收款记录` | `支出管理` | `工资结算`
*   **逻辑：**
    *   **审批流：** 策划师发起“请款申请”（如支付鲜花定金） ➔ 店长审批 ➔ 财务打款 ➔ 上传凭证。
    *   **只读权限：** 策划师在项目页可以看到“已付款”，但无法操作退款或修改金额。

### 6. 系统设置 (Settings)
*   **页面：** `账号权限` | `业务配置` | `SOP模板`
*   **逻辑：**
    *   **SOP配置：** 老板可以在此定义公司的标准服务流程（如：必须在婚礼前 30 天发函）。
    *   **报价模板：** 维护公司的标准服务项和底价。

---

## 4. 关键交互细节设计

### A. 敏感数据遮罩 (Data Masking)
*   **场景：** 当策划师在给客户展示电脑屏幕上的方案时。
*   **功能：** 界面右上角有一个 **"演示模式 (Presentation Mode)"** 开关。
*   **效果：** 一键开启后，所有涉及“成本”、“毛利”、“供应商联系方式”、“内部备注”的字段全部隐藏或变成 `***`。防止客户偷窥到公司底价。

### B. 操作日志 (Audit Log)
*   **场景：** 出现纠纷（如：谁把报价单改低了？谁删除了这个任务？）。
*   **逻辑：** 系统后台必须记录所有 **CUD (Create, Update, Delete)** 操作。
    *   *日志示例：* `[2025-11-24 10:30] User:张三 修改了 项目:李府婚礼 的 预算项:鲜花 从 ¥5000 改为 ¥4000`。

### C. 审批流交互 (Approval Workflow)
*   **场景：** 策划师申请一个低于公司规定的折扣。
*   **交互：**
    1.  策划师填写折扣理由，点击提交。
    2.  系统通过**钉钉/企业微信**接口，直接发消息给老板。
    3.  老板在手机上点击“同意”。
    4.  后台状态实时变为“审批通过”，策划师方可打印合同。

---

## 5. 技术架构与数据安全 (Security)

1.  **JWT (JSON Web Token) 鉴权：** 所有的 API 请求头必须携带 Token，后端解析 Token 中的 `role_id`，严格校验是否有权请求该接口。
2.  **数据行级权限 (Row-Level Security)：**
    *   查询 `SELECT * FROM projects` 时，必须强制追加 `WHERE owner_id = current_user_id` (针对普通策划师)。
3.  **自动登出：** 页面无操作 30 分钟后自动锁屏，防止策划师离开工位时泄露数据。

---

## 💡 总结

这套后台设计的核心在于**“克制”与“分权”**。

*   对**老板**，它是一个**经营仪表盘**（看利润）。
*   对**策划师**，它是一个**高效作业台**（做方案、管任务）。
*   对**财务**，它是一个**收支流水账**（管钱）。

至此，从前端小程序到后端管理系统，从业务逻辑到权限控制，我们已经完成了一个完整的婚礼 SaaS 系统设计蓝图。

**下一步建议：**
如果你准备进入开发阶段，我建议先从 **“线索(CRM) + 项目(Project) + 任务(Task)”** 这三个模块开始做 MVP 开发，因为这是最高频的业务闭环。预算和资源调度可以放在 v1.5 版本迭代。